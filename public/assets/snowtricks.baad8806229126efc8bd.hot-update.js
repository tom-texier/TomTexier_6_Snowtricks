"use strict";
self["webpackHotUpdatecwa_addons"]("snowtricks",{

/***/ "./assets/js/components/form/_custom-collection-type.js":
/*!**************************************************************!*\
  !*** ./assets/js/components/form/_custom-collection-type.js ***!
  \**************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "init": function() { return /* binding */ init; }
/* harmony export */ });
/* harmony import */ var _media__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../_media */ "./assets/js/components/_media.js");
/* harmony import */ var _display_conditions__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./_display-conditions */ "./assets/js/components/form/_display-conditions.js");


const collectionsContainersSelector = '.custom_collection_type_container';
const collectionsSelector = '.custom_collection_type';
const collectionsItemsClass = 'collection_item';
const collectionsItemsSelector = '.' + collectionsItemsClass;
const initializedClass = 'initialized';
const addBtnSelector = '.add_another_collection_widget';
const deleteBtnsClass = 'delete_another_collection_widget';
const deleteBtnsSelector = '.' + deleteBtnsClass;
function init() {
  let allCollections = document.querySelectorAll(collectionsSelector + ':not(.' + initializedClass + ')');
  allCollections.forEach(collection => {
    collection.classList.add(initializedClass);
    let collectionMinItems = getAttrValue(collection, 'data-min-items', true);
    let nbItems = getCollectionNbItems(collection);
    collection.querySelectorAll(collectionsItemsSelector).forEach(item => {
      addActions(collection, item);
    });

    if (collectionMinItems !== null && nbItems < collectionMinItems) {
      for (let i = nbItems + 1; i <= collectionMinItems; i++) {
        addItem(collection);
      }
    }

    checkForbiddenBtns(collection);
  });
  initAddBtnAction();
  initDeleteBtnAction();
  reInitEvents();
}

function reInit() {
  init();
}
/**
 * @param {Element|null} item_collection
 */


function reInitEvents(item_collection = null) {
  _media__WEBPACK_IMPORTED_MODULE_0__.reInit();
  _display_conditions__WEBPACK_IMPORTED_MODULE_1__.reInit(item_collection);
}
/**
 * Get HTML attribute value
 * @param {Element} target
 * @param {string} attr_name
 * @param {boolean} isNan
 */


function getAttrValue(target, attr_name, isNan = false) {
  let value = target.getAttribute(attr_name) === undefined ? null : target.getAttribute(attr_name);
  if (!isNan || value === null) return value;
  return parseInt(value);
}
/**
 * Get the count of items in the collection
 * @param {Element} collection
 */


function getCollectionNbItems(collection) {
  return getAttrValue(collection, 'data-widget-counter', true) || collection.children.length;
}
/**
 * Add some actions on collections items
 * @param {Element} collection
 * @param {Element} item
 */


function addActions(collection, item) {
  addDeleteBtn(collection, item);
}
/**
 * Add a delete button on a collection item
 * @param {Element} collection
 * @param {Element} item
 */


function addDeleteBtn(collection, item) {
  if (getAttrValue(collection, 'data-allow-delete', true) != 1) return false;
  let removeBtn = document.createElement('a');
  removeBtn.href = '#';
  removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
  removeBtn.classList.add(deleteBtnsClass);
  removeBtn = item.appendChild(removeBtn);
  removeBtn.addEventListener('click', removeBtnEvent);
}
/**
 * Check visibily for Add and Remove buttons according to configs and nbItems
 * @param {Element} collection
 */


function checkForbiddenBtns(collection) {
  let collectionMinItems = getAttrValue(collection, 'data-min-items', true);
  let collectionMaxItems = getAttrValue(collection, 'data-max-items', true);
  let nbItems = getCollectionNbItems(collection);
  let addBtn = collection.parentElement.querySelector(addBtnSelector);
  let removeBtns = collection.querySelectorAll(deleteBtnsSelector); // Add button

  if (collectionMaxItems !== null && nbItems === collectionMaxItems) {
    addBtn.style.display = 'none';
  } else {
    addBtn.style.display = 'block';
  } // Delete button


  if (collectionMinItems !== null && nbItems === collectionMinItems) {
    removeBtns.forEach(btn => {
      btn.style.display = 'none';
    });
  } else {
    removeBtns.forEach(btn => {
      btn.style.display = 'flex';
    });
  }
}
/**
 * Add an item in the collection
 * @param {Element} collection
 */


function addItem(collection) {
  let collectionMaxItems = getAttrValue(collection, 'data-max-items', true);
  let nbItems = getCollectionNbItems(collection);
  if (collectionMaxItems !== null && nbItems === collectionMaxItems) return false;
  let newWidget = getAttrValue(collection, 'data-prototype');
  let regex = new RegExp('__name__', 'g');

  if (getAttrValue(collection, 'data-prototype-name') !== '') {
    regex = new RegExp(getAttrValue(collection, 'data-prototype-name'), 'g');
  }

  nbItems++;
  newWidget = newWidget.replace(regex, nbItems);
  collection.setAttribute('data-widget-counter', nbItems);
  let newItem = document.createElement(getAttrValue(collection, 'data-widget-tags'));
  newItem.classList.add(collectionsItemsClass);
  newItem.innerHTML = newWidget;
  collection.appendChild(newItem);
  addActions(collection, newItem);
  checkForbiddenBtns(collection);
  reInitEvents();
  reInit();
}

function initAddBtnAction() {
  let addBtns = document.querySelectorAll(addBtnSelector);
  addBtns.forEach(btn => {
    btn.removeEventListener('click', addBtnEvent);
    btn.addEventListener('click', addBtnEvent);
  });
}

function addBtnEvent(e) {
  e.preventDefault();
  let target = e.target;
  let collection = document.querySelector(getAttrValue(target, 'data-collection-selector'));
  addItem(collection);
  checkForbiddenBtns(collection);
}

function initDeleteBtnAction() {
  let deleteBtns = document.querySelectorAll(deleteBtnsSelector);
  deleteBtns.forEach(btn => {
    btn.removeEventListener('click', removeBtnEvent);
    btn.addEventListener('click', removeBtnEvent);
  });
}

function removeBtnEvent(e) {
  e.preventDefault();
  let target = e.target;
  let collection = target.closest(collectionsSelector);
  let nbItems = getCollectionNbItems(collection);
  target.closest('.collection_item').remove();
  collection.setAttribute('data-widget-counter', nbItems - 1);
  checkForbiddenBtns(collection);
}

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ !function() {
/******/ 	__webpack_require__.h = function() { return "9e971f3f48ec46c61b8d"; }
/******/ }();
/******/ 
/******/ }
);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25vd3RyaWNrcy5iYWFkODgwNjIyOTEyNmVmYzhiZC5ob3QtdXBkYXRlLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFFQSxNQUFNRSw2QkFBNkIsR0FBRyxtQ0FBdEM7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyx5QkFBNUI7QUFDQSxNQUFNQyxxQkFBcUIsR0FBRyxpQkFBOUI7QUFDQSxNQUFNQyx3QkFBd0IsR0FBRyxNQUFNRCxxQkFBdkM7QUFFQSxNQUFNRSxnQkFBZ0IsR0FBRyxhQUF6QjtBQUNBLE1BQU1DLGNBQWMsR0FBRyxnQ0FBdkI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsa0NBQXhCO0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsTUFBTUQsZUFBakM7QUFFTyxTQUFTRSxJQUFULEdBQ1A7RUFDSSxJQUFJQyxjQUFjLEdBQUdDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEJWLG1CQUFtQixHQUFHLFFBQXRCLEdBQStCRyxnQkFBL0IsR0FBZ0QsR0FBMUUsQ0FBckI7RUFFQUssY0FBYyxDQUFDRyxPQUFmLENBQXdCQyxVQUFELElBQWdCO0lBQ25DQSxVQUFVLENBQUNDLFNBQVgsQ0FBcUJDLEdBQXJCLENBQXlCWCxnQkFBekI7SUFDQSxJQUFJWSxrQkFBa0IsR0FBR0MsWUFBWSxDQUFDSixVQUFELEVBQWEsZ0JBQWIsRUFBK0IsSUFBL0IsQ0FBckM7SUFDQSxJQUFJSyxPQUFPLEdBQUdDLG9CQUFvQixDQUFDTixVQUFELENBQWxDO0lBRUFBLFVBQVUsQ0FBQ0YsZ0JBQVgsQ0FBNEJSLHdCQUE1QixFQUFzRFMsT0FBdEQsQ0FBK0RRLElBQUQsSUFBVTtNQUNwRUMsVUFBVSxDQUFDUixVQUFELEVBQWFPLElBQWIsQ0FBVjtJQUNILENBRkQ7O0lBSUEsSUFBR0osa0JBQWtCLEtBQUssSUFBdkIsSUFBK0JFLE9BQU8sR0FBR0Ysa0JBQTVDLEVBQWdFO01BQzVELEtBQUksSUFBSU0sQ0FBQyxHQUFHSixPQUFPLEdBQUcsQ0FBdEIsRUFBeUJJLENBQUMsSUFBSU4sa0JBQTlCLEVBQWtETSxDQUFDLEVBQW5ELEVBQXVEO1FBQ25EQyxPQUFPLENBQUNWLFVBQUQsQ0FBUDtNQUNIO0lBQ0o7O0lBRURXLGtCQUFrQixDQUFDWCxVQUFELENBQWxCO0VBQ0gsQ0FoQkQ7RUFrQkFZLGdCQUFnQjtFQUNoQkMsbUJBQW1CO0VBQ25CQyxZQUFZO0FBQ2Y7O0FBRUQsU0FBU0MsTUFBVCxHQUNBO0VBQ0lwQixJQUFJO0FBQ1A7QUFFRDtBQUNBO0FBQ0E7OztBQUNBLFNBQVNtQixZQUFULENBQXNCRSxlQUFlLEdBQUcsSUFBeEMsRUFDQTtFQUNJL0IsMENBQUE7RUFDQUMsdURBQUEsQ0FBeUI4QixlQUF6QjtBQUNIO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQSxTQUFTWixZQUFULENBQXNCYSxNQUF0QixFQUE4QkMsU0FBOUIsRUFBeUNDLEtBQUssR0FBRyxLQUFqRCxFQUNBO0VBQ0ksSUFBSUMsS0FBSyxHQUFHSCxNQUFNLENBQUNJLFlBQVAsQ0FBb0JILFNBQXBCLE1BQW1DSSxTQUFuQyxHQUErQyxJQUEvQyxHQUFzREwsTUFBTSxDQUFDSSxZQUFQLENBQW9CSCxTQUFwQixDQUFsRTtFQUVBLElBQUcsQ0FBQ0MsS0FBRCxJQUFVQyxLQUFLLEtBQUssSUFBdkIsRUFBNkIsT0FBT0EsS0FBUDtFQUU3QixPQUFPRyxRQUFRLENBQUNILEtBQUQsQ0FBZjtBQUNIO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNkLG9CQUFULENBQThCTixVQUE5QixFQUNBO0VBQ0ksT0FBT0ksWUFBWSxDQUFDSixVQUFELEVBQWEscUJBQWIsRUFBb0MsSUFBcEMsQ0FBWixJQUF5REEsVUFBVSxDQUFDd0IsUUFBWCxDQUFvQkMsTUFBcEY7QUFDSDtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNqQixVQUFULENBQW9CUixVQUFwQixFQUFnQ08sSUFBaEMsRUFDQTtFQUNJbUIsWUFBWSxDQUFDMUIsVUFBRCxFQUFhTyxJQUFiLENBQVo7QUFDSDtBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBLFNBQVNtQixZQUFULENBQXNCMUIsVUFBdEIsRUFBa0NPLElBQWxDLEVBQ0E7RUFDSSxJQUFHSCxZQUFZLENBQUNKLFVBQUQsRUFBYSxtQkFBYixFQUFrQyxJQUFsQyxDQUFaLElBQXVELENBQTFELEVBQTZELE9BQU8sS0FBUDtFQUU3RCxJQUFJMkIsU0FBUyxHQUFHOUIsUUFBUSxDQUFDK0IsYUFBVCxDQUF1QixHQUF2QixDQUFoQjtFQUNBRCxTQUFTLENBQUNFLElBQVYsR0FBaUIsR0FBakI7RUFDQUYsU0FBUyxDQUFDRyxTQUFWLEdBQXNCLDhCQUF0QjtFQUNBSCxTQUFTLENBQUMxQixTQUFWLENBQW9CQyxHQUFwQixDQUF3QlQsZUFBeEI7RUFDQWtDLFNBQVMsR0FBR3BCLElBQUksQ0FBQ3dCLFdBQUwsQ0FBaUJKLFNBQWpCLENBQVo7RUFFQUEsU0FBUyxDQUFDSyxnQkFBVixDQUEyQixPQUEzQixFQUFvQ0MsY0FBcEM7QUFDSDtBQUVEO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQSxTQUFTdEIsa0JBQVQsQ0FBNEJYLFVBQTVCLEVBQ0E7RUFDSSxJQUFJRyxrQkFBa0IsR0FBR0MsWUFBWSxDQUFDSixVQUFELEVBQWEsZ0JBQWIsRUFBK0IsSUFBL0IsQ0FBckM7RUFDQSxJQUFJa0Msa0JBQWtCLEdBQUc5QixZQUFZLENBQUNKLFVBQUQsRUFBYSxnQkFBYixFQUErQixJQUEvQixDQUFyQztFQUNBLElBQUlLLE9BQU8sR0FBR0Msb0JBQW9CLENBQUNOLFVBQUQsQ0FBbEM7RUFFQSxJQUFJbUMsTUFBTSxHQUFHbkMsVUFBVSxDQUFDb0MsYUFBWCxDQUF5QkMsYUFBekIsQ0FBdUM3QyxjQUF2QyxDQUFiO0VBQ0EsSUFBSThDLFVBQVUsR0FBR3RDLFVBQVUsQ0FBQ0YsZ0JBQVgsQ0FBNEJKLGtCQUE1QixDQUFqQixDQU5KLENBUUk7O0VBQ0EsSUFBSXdDLGtCQUFrQixLQUFLLElBQXZCLElBQStCN0IsT0FBTyxLQUFLNkIsa0JBQS9DLEVBQW1FO0lBQy9EQyxNQUFNLENBQUNJLEtBQVAsQ0FBYUMsT0FBYixHQUF1QixNQUF2QjtFQUNILENBRkQsTUFHSztJQUNETCxNQUFNLENBQUNJLEtBQVAsQ0FBYUMsT0FBYixHQUF1QixPQUF2QjtFQUNILENBZEwsQ0FnQkk7OztFQUNBLElBQUdyQyxrQkFBa0IsS0FBSyxJQUF2QixJQUErQkUsT0FBTyxLQUFLRixrQkFBOUMsRUFBa0U7SUFDOURtQyxVQUFVLENBQUN2QyxPQUFYLENBQW9CMEMsR0FBRCxJQUFTO01BQ3hCQSxHQUFHLENBQUNGLEtBQUosQ0FBVUMsT0FBVixHQUFvQixNQUFwQjtJQUNILENBRkQ7RUFHSCxDQUpELE1BS0s7SUFDREYsVUFBVSxDQUFDdkMsT0FBWCxDQUFvQjBDLEdBQUQsSUFBUztNQUN4QkEsR0FBRyxDQUFDRixLQUFKLENBQVVDLE9BQVYsR0FBb0IsTUFBcEI7SUFDSCxDQUZEO0VBR0g7QUFDSjtBQUVEO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQSxTQUFTOUIsT0FBVCxDQUFpQlYsVUFBakIsRUFDQTtFQUNJLElBQUlrQyxrQkFBa0IsR0FBRzlCLFlBQVksQ0FBQ0osVUFBRCxFQUFhLGdCQUFiLEVBQStCLElBQS9CLENBQXJDO0VBQ0EsSUFBSUssT0FBTyxHQUFHQyxvQkFBb0IsQ0FBQ04sVUFBRCxDQUFsQztFQUVBLElBQUdrQyxrQkFBa0IsS0FBSyxJQUF2QixJQUErQjdCLE9BQU8sS0FBSzZCLGtCQUE5QyxFQUFrRSxPQUFPLEtBQVA7RUFFbEUsSUFBSVEsU0FBUyxHQUFHdEMsWUFBWSxDQUFDSixVQUFELEVBQWEsZ0JBQWIsQ0FBNUI7RUFDQSxJQUFJMkMsS0FBSyxHQUFHLElBQUlDLE1BQUosQ0FBVyxVQUFYLEVBQXVCLEdBQXZCLENBQVo7O0VBQ0EsSUFBR3hDLFlBQVksQ0FBQ0osVUFBRCxFQUFhLHFCQUFiLENBQVosS0FBb0QsRUFBdkQsRUFBMkQ7SUFDdkQyQyxLQUFLLEdBQUcsSUFBSUMsTUFBSixDQUFXeEMsWUFBWSxDQUFDSixVQUFELEVBQWEscUJBQWIsQ0FBdkIsRUFBNEQsR0FBNUQsQ0FBUjtFQUNIOztFQUNESyxPQUFPO0VBQ1BxQyxTQUFTLEdBQUdBLFNBQVMsQ0FBQ0csT0FBVixDQUFrQkYsS0FBbEIsRUFBeUJ0QyxPQUF6QixDQUFaO0VBQ0FMLFVBQVUsQ0FBQzhDLFlBQVgsQ0FBd0IscUJBQXhCLEVBQStDekMsT0FBL0M7RUFFQSxJQUFJMEMsT0FBTyxHQUFHbEQsUUFBUSxDQUFDK0IsYUFBVCxDQUF1QnhCLFlBQVksQ0FBQ0osVUFBRCxFQUFhLGtCQUFiLENBQW5DLENBQWQ7RUFDQStDLE9BQU8sQ0FBQzlDLFNBQVIsQ0FBa0JDLEdBQWxCLENBQXNCYixxQkFBdEI7RUFDQTBELE9BQU8sQ0FBQ2pCLFNBQVIsR0FBb0JZLFNBQXBCO0VBRUExQyxVQUFVLENBQUMrQixXQUFYLENBQXVCZ0IsT0FBdkI7RUFFQXZDLFVBQVUsQ0FBQ1IsVUFBRCxFQUFhK0MsT0FBYixDQUFWO0VBQ0FwQyxrQkFBa0IsQ0FBQ1gsVUFBRCxDQUFsQjtFQUVBYyxZQUFZO0VBQ1pDLE1BQU07QUFDVDs7QUFFRCxTQUFTSCxnQkFBVCxHQUNBO0VBQ0ksSUFBSW9DLE9BQU8sR0FBR25ELFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEJOLGNBQTFCLENBQWQ7RUFDQXdELE9BQU8sQ0FBQ2pELE9BQVIsQ0FBaUIwQyxHQUFELElBQVM7SUFDckJBLEdBQUcsQ0FBQ1EsbUJBQUosQ0FBd0IsT0FBeEIsRUFBaUNDLFdBQWpDO0lBQ0FULEdBQUcsQ0FBQ1QsZ0JBQUosQ0FBcUIsT0FBckIsRUFBOEJrQixXQUE5QjtFQUNILENBSEQ7QUFJSDs7QUFFRCxTQUFTQSxXQUFULENBQXFCQyxDQUFyQixFQUNBO0VBQ0lBLENBQUMsQ0FBQ0MsY0FBRjtFQUNBLElBQUluQyxNQUFNLEdBQUdrQyxDQUFDLENBQUNsQyxNQUFmO0VBQ0EsSUFBSWpCLFVBQVUsR0FBR0gsUUFBUSxDQUFDd0MsYUFBVCxDQUF1QmpDLFlBQVksQ0FBQ2EsTUFBRCxFQUFTLDBCQUFULENBQW5DLENBQWpCO0VBQ0FQLE9BQU8sQ0FBQ1YsVUFBRCxDQUFQO0VBQ0FXLGtCQUFrQixDQUFDWCxVQUFELENBQWxCO0FBQ0g7O0FBRUQsU0FBU2EsbUJBQVQsR0FDQTtFQUNJLElBQUl3QyxVQUFVLEdBQUd4RCxRQUFRLENBQUNDLGdCQUFULENBQTBCSixrQkFBMUIsQ0FBakI7RUFDQTJELFVBQVUsQ0FBQ3RELE9BQVgsQ0FBb0IwQyxHQUFELElBQVM7SUFDeEJBLEdBQUcsQ0FBQ1EsbUJBQUosQ0FBd0IsT0FBeEIsRUFBaUNoQixjQUFqQztJQUNBUSxHQUFHLENBQUNULGdCQUFKLENBQXFCLE9BQXJCLEVBQThCQyxjQUE5QjtFQUNILENBSEQ7QUFJSDs7QUFFRCxTQUFTQSxjQUFULENBQXdCa0IsQ0FBeEIsRUFDQTtFQUNJQSxDQUFDLENBQUNDLGNBQUY7RUFDQSxJQUFJbkMsTUFBTSxHQUFHa0MsQ0FBQyxDQUFDbEMsTUFBZjtFQUNBLElBQUlqQixVQUFVLEdBQUdpQixNQUFNLENBQUNxQyxPQUFQLENBQWVsRSxtQkFBZixDQUFqQjtFQUNBLElBQUlpQixPQUFPLEdBQUdDLG9CQUFvQixDQUFDTixVQUFELENBQWxDO0VBQ0FpQixNQUFNLENBQUNxQyxPQUFQLENBQWUsa0JBQWYsRUFBbUNDLE1BQW5DO0VBQ0F2RCxVQUFVLENBQUM4QyxZQUFYLENBQXdCLHFCQUF4QixFQUErQ3pDLE9BQU8sR0FBRyxDQUF6RDtFQUVBTSxrQkFBa0IsQ0FBQ1gsVUFBRCxDQUFsQjtBQUNIOzs7Ozs7OztVQ2xORCxxQ0FBcUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jd2EtYWRkb25zLy4vYXNzZXRzL2pzL2NvbXBvbmVudHMvZm9ybS9fY3VzdG9tLWNvbGxlY3Rpb24tdHlwZS5qcyIsIndlYnBhY2s6Ly9jd2EtYWRkb25zL3dlYnBhY2svcnVudGltZS9nZXRGdWxsSGFzaCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBNZWRpYSBmcm9tICcuLi9fbWVkaWEnO1xuaW1wb3J0ICogYXMgRGlzcGxheUNvbmRpdGlvbnMgZnJvbSAnLi9fZGlzcGxheS1jb25kaXRpb25zJztcblxuY29uc3QgY29sbGVjdGlvbnNDb250YWluZXJzU2VsZWN0b3IgPSAnLmN1c3RvbV9jb2xsZWN0aW9uX3R5cGVfY29udGFpbmVyJztcbmNvbnN0IGNvbGxlY3Rpb25zU2VsZWN0b3IgPSAnLmN1c3RvbV9jb2xsZWN0aW9uX3R5cGUnO1xuY29uc3QgY29sbGVjdGlvbnNJdGVtc0NsYXNzID0gJ2NvbGxlY3Rpb25faXRlbSc7XG5jb25zdCBjb2xsZWN0aW9uc0l0ZW1zU2VsZWN0b3IgPSAnLicgKyBjb2xsZWN0aW9uc0l0ZW1zQ2xhc3M7XG5cbmNvbnN0IGluaXRpYWxpemVkQ2xhc3MgPSAnaW5pdGlhbGl6ZWQnO1xuY29uc3QgYWRkQnRuU2VsZWN0b3IgPSAnLmFkZF9hbm90aGVyX2NvbGxlY3Rpb25fd2lkZ2V0JztcbmNvbnN0IGRlbGV0ZUJ0bnNDbGFzcyA9ICdkZWxldGVfYW5vdGhlcl9jb2xsZWN0aW9uX3dpZGdldCc7XG5jb25zdCBkZWxldGVCdG5zU2VsZWN0b3IgPSAnLicgKyBkZWxldGVCdG5zQ2xhc3M7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KClcbntcbiAgICBsZXQgYWxsQ29sbGVjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbGxlY3Rpb25zU2VsZWN0b3IgKyAnOm5vdCguJytpbml0aWFsaXplZENsYXNzKycpJyk7XG5cbiAgICBhbGxDb2xsZWN0aW9ucy5mb3JFYWNoKChjb2xsZWN0aW9uKSA9PiB7XG4gICAgICAgIGNvbGxlY3Rpb24uY2xhc3NMaXN0LmFkZChpbml0aWFsaXplZENsYXNzKTtcbiAgICAgICAgbGV0IGNvbGxlY3Rpb25NaW5JdGVtcyA9IGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS1taW4taXRlbXMnLCB0cnVlKTtcbiAgICAgICAgbGV0IG5iSXRlbXMgPSBnZXRDb2xsZWN0aW9uTmJJdGVtcyhjb2xsZWN0aW9uKTtcblxuICAgICAgICBjb2xsZWN0aW9uLnF1ZXJ5U2VsZWN0b3JBbGwoY29sbGVjdGlvbnNJdGVtc1NlbGVjdG9yKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICBhZGRBY3Rpb25zKGNvbGxlY3Rpb24sIGl0ZW0pO1xuICAgICAgICB9KVxuXG4gICAgICAgIGlmKGNvbGxlY3Rpb25NaW5JdGVtcyAhPT0gbnVsbCAmJiBuYkl0ZW1zIDwgY29sbGVjdGlvbk1pbkl0ZW1zKSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSBuYkl0ZW1zICsgMTsgaSA8PSBjb2xsZWN0aW9uTWluSXRlbXM7IGkrKykge1xuICAgICAgICAgICAgICAgIGFkZEl0ZW0oY29sbGVjdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjaGVja0ZvcmJpZGRlbkJ0bnMoY29sbGVjdGlvbik7XG4gICAgfSlcblxuICAgIGluaXRBZGRCdG5BY3Rpb24oKTtcbiAgICBpbml0RGVsZXRlQnRuQWN0aW9uKCk7XG4gICAgcmVJbml0RXZlbnRzKCk7XG59XG5cbmZ1bmN0aW9uIHJlSW5pdCgpXG57XG4gICAgaW5pdCgpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudHxudWxsfSBpdGVtX2NvbGxlY3Rpb25cbiAqL1xuZnVuY3Rpb24gcmVJbml0RXZlbnRzKGl0ZW1fY29sbGVjdGlvbiA9IG51bGwpXG57XG4gICAgTWVkaWEucmVJbml0KCk7XG4gICAgRGlzcGxheUNvbmRpdGlvbnMucmVJbml0KGl0ZW1fY29sbGVjdGlvbik7XG59XG5cbi8qKlxuICogR2V0IEhUTUwgYXR0cmlidXRlIHZhbHVlXG4gKiBAcGFyYW0ge0VsZW1lbnR9IHRhcmdldFxuICogQHBhcmFtIHtzdHJpbmd9IGF0dHJfbmFtZVxuICogQHBhcmFtIHtib29sZWFufSBpc05hblxuICovXG5mdW5jdGlvbiBnZXRBdHRyVmFsdWUodGFyZ2V0LCBhdHRyX25hbWUsIGlzTmFuID0gZmFsc2UpXG57XG4gICAgbGV0IHZhbHVlID0gdGFyZ2V0LmdldEF0dHJpYnV0ZShhdHRyX25hbWUpID09PSB1bmRlZmluZWQgPyBudWxsIDogdGFyZ2V0LmdldEF0dHJpYnV0ZShhdHRyX25hbWUpO1xuXG4gICAgaWYoIWlzTmFuIHx8IHZhbHVlID09PSBudWxsKSByZXR1cm4gdmFsdWU7XG5cbiAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgY291bnQgb2YgaXRlbXMgaW4gdGhlIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7RWxlbWVudH0gY29sbGVjdGlvblxuICovXG5mdW5jdGlvbiBnZXRDb2xsZWN0aW9uTmJJdGVtcyhjb2xsZWN0aW9uKVxue1xuICAgIHJldHVybiBnZXRBdHRyVmFsdWUoY29sbGVjdGlvbiwgJ2RhdGEtd2lkZ2V0LWNvdW50ZXInLCB0cnVlKSB8fCBjb2xsZWN0aW9uLmNoaWxkcmVuLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBBZGQgc29tZSBhY3Rpb25zIG9uIGNvbGxlY3Rpb25zIGl0ZW1zXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7RWxlbWVudH0gaXRlbVxuICovXG5mdW5jdGlvbiBhZGRBY3Rpb25zKGNvbGxlY3Rpb24sIGl0ZW0pXG57XG4gICAgYWRkRGVsZXRlQnRuKGNvbGxlY3Rpb24sIGl0ZW0pO1xufVxuXG4vKipcbiAqIEFkZCBhIGRlbGV0ZSBidXR0b24gb24gYSBjb2xsZWN0aW9uIGl0ZW1cbiAqIEBwYXJhbSB7RWxlbWVudH0gY29sbGVjdGlvblxuICogQHBhcmFtIHtFbGVtZW50fSBpdGVtXG4gKi9cbmZ1bmN0aW9uIGFkZERlbGV0ZUJ0bihjb2xsZWN0aW9uLCBpdGVtKVxue1xuICAgIGlmKGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS1hbGxvdy1kZWxldGUnLCB0cnVlKSAhPSAxKSByZXR1cm4gZmFsc2U7XG5cbiAgICBsZXQgcmVtb3ZlQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgIHJlbW92ZUJ0bi5ocmVmID0gJyMnO1xuICAgIHJlbW92ZUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYXMgZmEtdHJhc2hcIj48L2k+JztcbiAgICByZW1vdmVCdG4uY2xhc3NMaXN0LmFkZChkZWxldGVCdG5zQ2xhc3MpO1xuICAgIHJlbW92ZUJ0biA9IGl0ZW0uYXBwZW5kQ2hpbGQocmVtb3ZlQnRuKTtcblxuICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbW92ZUJ0bkV2ZW50KTtcbn1cblxuLyoqXG4gKiBDaGVjayB2aXNpYmlseSBmb3IgQWRkIGFuZCBSZW1vdmUgYnV0dG9ucyBhY2NvcmRpbmcgdG8gY29uZmlncyBhbmQgbmJJdGVtc1xuICogQHBhcmFtIHtFbGVtZW50fSBjb2xsZWN0aW9uXG4gKi9cbmZ1bmN0aW9uIGNoZWNrRm9yYmlkZGVuQnRucyhjb2xsZWN0aW9uKVxue1xuICAgIGxldCBjb2xsZWN0aW9uTWluSXRlbXMgPSBnZXRBdHRyVmFsdWUoY29sbGVjdGlvbiwgJ2RhdGEtbWluLWl0ZW1zJywgdHJ1ZSk7XG4gICAgbGV0IGNvbGxlY3Rpb25NYXhJdGVtcyA9IGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS1tYXgtaXRlbXMnLCB0cnVlKTtcbiAgICBsZXQgbmJJdGVtcyA9IGdldENvbGxlY3Rpb25OYkl0ZW1zKGNvbGxlY3Rpb24pO1xuXG4gICAgbGV0IGFkZEJ0biA9IGNvbGxlY3Rpb24ucGFyZW50RWxlbWVudC5xdWVyeVNlbGVjdG9yKGFkZEJ0blNlbGVjdG9yKTtcbiAgICBsZXQgcmVtb3ZlQnRucyA9IGNvbGxlY3Rpb24ucXVlcnlTZWxlY3RvckFsbChkZWxldGVCdG5zU2VsZWN0b3IpO1xuXG4gICAgLy8gQWRkIGJ1dHRvblxuICAgIGlmIChjb2xsZWN0aW9uTWF4SXRlbXMgIT09IG51bGwgJiYgbmJJdGVtcyA9PT0gY29sbGVjdGlvbk1heEl0ZW1zKSB7XG4gICAgICAgIGFkZEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYWRkQnRuLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIH1cblxuICAgIC8vIERlbGV0ZSBidXR0b25cbiAgICBpZihjb2xsZWN0aW9uTWluSXRlbXMgIT09IG51bGwgJiYgbmJJdGVtcyA9PT0gY29sbGVjdGlvbk1pbkl0ZW1zKSB7XG4gICAgICAgIHJlbW92ZUJ0bnMuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICAgICAgICBidG4uc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJlbW92ZUJ0bnMuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICAgICAgICBidG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbi8qKlxuICogQWRkIGFuIGl0ZW0gaW4gdGhlIGNvbGxlY3Rpb25cbiAqIEBwYXJhbSB7RWxlbWVudH0gY29sbGVjdGlvblxuICovXG5mdW5jdGlvbiBhZGRJdGVtKGNvbGxlY3Rpb24pXG57XG4gICAgbGV0IGNvbGxlY3Rpb25NYXhJdGVtcyA9IGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS1tYXgtaXRlbXMnLCB0cnVlKTtcbiAgICBsZXQgbmJJdGVtcyA9IGdldENvbGxlY3Rpb25OYkl0ZW1zKGNvbGxlY3Rpb24pO1xuXG4gICAgaWYoY29sbGVjdGlvbk1heEl0ZW1zICE9PSBudWxsICYmIG5iSXRlbXMgPT09IGNvbGxlY3Rpb25NYXhJdGVtcykgcmV0dXJuIGZhbHNlO1xuXG4gICAgbGV0IG5ld1dpZGdldCA9IGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS1wcm90b3R5cGUnKTtcbiAgICBsZXQgcmVnZXggPSBuZXcgUmVnRXhwKCdfX25hbWVfXycsICdnJyk7XG4gICAgaWYoZ2V0QXR0clZhbHVlKGNvbGxlY3Rpb24sICdkYXRhLXByb3RvdHlwZS1uYW1lJykgIT09ICcnKSB7XG4gICAgICAgIHJlZ2V4ID0gbmV3IFJlZ0V4cChnZXRBdHRyVmFsdWUoY29sbGVjdGlvbiwgJ2RhdGEtcHJvdG90eXBlLW5hbWUnKSwgJ2cnKTtcbiAgICB9XG4gICAgbmJJdGVtcysrO1xuICAgIG5ld1dpZGdldCA9IG5ld1dpZGdldC5yZXBsYWNlKHJlZ2V4LCBuYkl0ZW1zKTtcbiAgICBjb2xsZWN0aW9uLnNldEF0dHJpYnV0ZSgnZGF0YS13aWRnZXQtY291bnRlcicsIG5iSXRlbXMpO1xuXG4gICAgbGV0IG5ld0l0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGdldEF0dHJWYWx1ZShjb2xsZWN0aW9uLCAnZGF0YS13aWRnZXQtdGFncycpKTtcbiAgICBuZXdJdGVtLmNsYXNzTGlzdC5hZGQoY29sbGVjdGlvbnNJdGVtc0NsYXNzKTtcbiAgICBuZXdJdGVtLmlubmVySFRNTCA9IG5ld1dpZGdldDtcblxuICAgIGNvbGxlY3Rpb24uYXBwZW5kQ2hpbGQobmV3SXRlbSk7XG5cbiAgICBhZGRBY3Rpb25zKGNvbGxlY3Rpb24sIG5ld0l0ZW0pO1xuICAgIGNoZWNrRm9yYmlkZGVuQnRucyhjb2xsZWN0aW9uKTtcblxuICAgIHJlSW5pdEV2ZW50cygpO1xuICAgIHJlSW5pdCgpO1xufVxuXG5mdW5jdGlvbiBpbml0QWRkQnRuQWN0aW9uKClcbntcbiAgICBsZXQgYWRkQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYWRkQnRuU2VsZWN0b3IpO1xuICAgIGFkZEJ0bnMuZm9yRWFjaCgoYnRuKSA9PiB7XG4gICAgICAgIGJ0bi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGFkZEJ0bkV2ZW50KTtcbiAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkQnRuRXZlbnQpO1xuICAgIH0pXG59XG5cbmZ1bmN0aW9uIGFkZEJ0bkV2ZW50KGUpXG57XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBsZXQgY29sbGVjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZ2V0QXR0clZhbHVlKHRhcmdldCwgJ2RhdGEtY29sbGVjdGlvbi1zZWxlY3RvcicpKTtcbiAgICBhZGRJdGVtKGNvbGxlY3Rpb24pO1xuICAgIGNoZWNrRm9yYmlkZGVuQnRucyhjb2xsZWN0aW9uKTtcbn1cblxuZnVuY3Rpb24gaW5pdERlbGV0ZUJ0bkFjdGlvbigpXG57XG4gICAgbGV0IGRlbGV0ZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGRlbGV0ZUJ0bnNTZWxlY3Rvcik7XG4gICAgZGVsZXRlQnRucy5mb3JFYWNoKChidG4pID0+IHtcbiAgICAgICAgYnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVtb3ZlQnRuRXZlbnQpO1xuICAgICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZW1vdmVCdG5FdmVudCk7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gcmVtb3ZlQnRuRXZlbnQoZSlcbntcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgIGxldCBjb2xsZWN0aW9uID0gdGFyZ2V0LmNsb3Nlc3QoY29sbGVjdGlvbnNTZWxlY3Rvcik7XG4gICAgbGV0IG5iSXRlbXMgPSBnZXRDb2xsZWN0aW9uTmJJdGVtcyhjb2xsZWN0aW9uKTtcbiAgICB0YXJnZXQuY2xvc2VzdCgnLmNvbGxlY3Rpb25faXRlbScpLnJlbW92ZSgpO1xuICAgIGNvbGxlY3Rpb24uc2V0QXR0cmlidXRlKCdkYXRhLXdpZGdldC1jb3VudGVyJywgbmJJdGVtcyAtIDEpO1xuXG4gICAgY2hlY2tGb3JiaWRkZW5CdG5zKGNvbGxlY3Rpb24pO1xufSIsIl9fd2VicGFja19yZXF1aXJlX18uaCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gXCI5ZTk3MWYzZjQ4ZWM0NmM2MWI4ZFwiOyB9Il0sIm5hbWVzIjpbIk1lZGlhIiwiRGlzcGxheUNvbmRpdGlvbnMiLCJjb2xsZWN0aW9uc0NvbnRhaW5lcnNTZWxlY3RvciIsImNvbGxlY3Rpb25zU2VsZWN0b3IiLCJjb2xsZWN0aW9uc0l0ZW1zQ2xhc3MiLCJjb2xsZWN0aW9uc0l0ZW1zU2VsZWN0b3IiLCJpbml0aWFsaXplZENsYXNzIiwiYWRkQnRuU2VsZWN0b3IiLCJkZWxldGVCdG5zQ2xhc3MiLCJkZWxldGVCdG5zU2VsZWN0b3IiLCJpbml0IiwiYWxsQ29sbGVjdGlvbnMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiY29sbGVjdGlvbiIsImNsYXNzTGlzdCIsImFkZCIsImNvbGxlY3Rpb25NaW5JdGVtcyIsImdldEF0dHJWYWx1ZSIsIm5iSXRlbXMiLCJnZXRDb2xsZWN0aW9uTmJJdGVtcyIsIml0ZW0iLCJhZGRBY3Rpb25zIiwiaSIsImFkZEl0ZW0iLCJjaGVja0ZvcmJpZGRlbkJ0bnMiLCJpbml0QWRkQnRuQWN0aW9uIiwiaW5pdERlbGV0ZUJ0bkFjdGlvbiIsInJlSW5pdEV2ZW50cyIsInJlSW5pdCIsIml0ZW1fY29sbGVjdGlvbiIsInRhcmdldCIsImF0dHJfbmFtZSIsImlzTmFuIiwidmFsdWUiLCJnZXRBdHRyaWJ1dGUiLCJ1bmRlZmluZWQiLCJwYXJzZUludCIsImNoaWxkcmVuIiwibGVuZ3RoIiwiYWRkRGVsZXRlQnRuIiwicmVtb3ZlQnRuIiwiY3JlYXRlRWxlbWVudCIsImhyZWYiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVCdG5FdmVudCIsImNvbGxlY3Rpb25NYXhJdGVtcyIsImFkZEJ0biIsInBhcmVudEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicmVtb3ZlQnRucyIsInN0eWxlIiwiZGlzcGxheSIsImJ0biIsIm5ld1dpZGdldCIsInJlZ2V4IiwiUmVnRXhwIiwicmVwbGFjZSIsInNldEF0dHJpYnV0ZSIsIm5ld0l0ZW0iLCJhZGRCdG5zIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImFkZEJ0bkV2ZW50IiwiZSIsInByZXZlbnREZWZhdWx0IiwiZGVsZXRlQnRucyIsImNsb3Nlc3QiLCJyZW1vdmUiXSwic291cmNlUm9vdCI6IiJ9